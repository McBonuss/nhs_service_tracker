{% extends "base.html" %}
{% block content %}
<h1>NHS Service Tracker Dashboard</h1>
<p>Welcome back, {{ user.first_name|default:user.username }}. Here's your system overview.</p>

<div class="stats-grid">
  <div class="stat-card patients">
    <h3>{{ total_patients }}</h3>
    <p>Total Patients</p>
    <small>{{ active_patients }} active</small>
  </div>
  <div class="stat-card appointments">
    <h3>{{ today_appointments }}</h3>
    <p>Today's Appointments</p>
    <small>{{ this_week_appointments }} this week</small>
  </div>
  <div class="stat-card priority">
    <h3>{{ urgent_patients|add:high_priority_patients }}</h3>
    <p>Priority Patients</p>
    <small>{{ urgent_patients }} urgent, {{ high_priority_patients }} high</small>
  </div>
  <div class="stat-card services">
    <h3>{{ total_services }}</h3>
    <p>NHS Services</p>
    <small>Available for booking</small>
  </div>
</div>

<div class="dashboard-section">
  <h2>Patient Status Distribution</h2>
  <div class="status-overview">
    {% for status, count in status_stats.items %}
    <div class="status-item status-{{ status }}">
      <span class="status-count">{{ count }}</span>
      <span class="status-label">{{ status|title }}</span>
    </div>
    {% endfor %}
  </div>
</div>

<div class="dashboard-section">
  <h2>Quick Actions</h2>
  <div class="grid">
    <a class="card action-card" href="{% url 'patients_create' %}">
      <h3>Add New Patient</h3>
      <p>Register a new patient in the system</p>
    </a>
    <a class="card action-card" href="{% url 'appointments_create' %}">
      <h3>Schedule Appointment</h3>
      <p>Book a new appointment for existing patients</p>
    </a>
    <a class="card action-card" href="{% url 'patients_list' %}">
      <h3>Search Patients</h3>
      <p>Find and manage patient records</p>
    </a>
    <a class="card action-card" href="{% url 'services_list' %}">
      <h3>Manage Services</h3>
      <p>View and configure NHS services</p>
    </a>
  </div>
</div>

<div class="dashboard-row">
  <div class="dashboard-column">
    <h2>Recent Patients</h2>
    {% if recent_patients %}
    <div class="recent-list">
      {% for patient in recent_patients %}
      <div class="recent-item">
        <a href="{% url 'patients_detail' patient.id %}">
          <strong>{{ patient.first_name }} {{ patient.last_name }}</strong>
        </a>
        <span class="patient-info">
          NHS: {{ patient.nhs_number }} |
          <span class="status-badge status-{{ patient.status }}">{{ patient.status|title }}</span>
          <span class="priority-badge priority-{{ patient.priority }}">{{ patient.priority|title }}</span>
        </span>
        <small>Added {{ patient.created_at|date:"d M Y" }}</small>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p>No recent patients to display.</p>
    {% endif %}
  </div>

  <div class="dashboard-column">
    <h2>Upcoming Appointments</h2>
    {% if urgent_appointments %}
    <div class="urgent-list">
      {% for appointment in urgent_appointments %}
      <div class="urgent-item">
        <div class="appointment-time">
          <strong>{{ appointment.scheduled_for|date:"d M" }}</strong>
          <small>{{ appointment.scheduled_for|date:"H:i" }}</small>
        </div>
        <div class="appointment-details">
          <a href="{% url 'patients_detail' appointment.patient.id %}">
            {{ appointment.patient.first_name }} {{ appointment.patient.last_name }}
          </a>
          <small>{{ appointment.service.name }} - {{ appointment.location }}</small>
          <span class="priority-badge priority-{{ appointment.patient.priority }}">
            {{ appointment.patient.priority|title }}
          </span>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p>No urgent appointments in the next 24 hours.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
