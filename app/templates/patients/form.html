{% extends "base.html" %}
{% block content %}
<h1>{{ mode }} Patient</h1>
{% if patient %}
<div class="current-patient-info">
  <p>Editing: <strong>{{ patient.first_name }} {{ patient.last_name }}</strong> ({{ patient.nhs_number }})</p>
</div>
{% endif %}

<form method="post" novalidate class="patient-form">
  {{ form.hidden_tag() }}
  
  <div class="form-section">
    <h2>Basic Information</h2>
    <div class="form-row">
      <div class="form-group">
        {{ form.nhs_number.label(class="form-label") }}
        {{ form.nhs_number(class="form-input") }}
        {% if form.nhs_number.errors %}
          <div class="form-errors">
            {% for error in form.nhs_number.errors %}<span class="error">{{ error }}</span>{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        {{ form.first_name.label(class="form-label") }}
        {{ form.first_name(class="form-input") }}
        {% if form.first_name.errors %}
          <div class="form-errors">
            {% for error in form.first_name.errors %}<span class="error">{{ error }}</span>{% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="form-group">
        {{ form.last_name.label(class="form-label") }}
        {{ form.last_name(class="form-input") }}
        {% if form.last_name.errors %}
          <div class="form-errors">
            {% for error in form.last_name.errors %}<span class="error">{{ error }}</span>{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        {{ form.date_of_birth.label(class="form-label") }}
        {{ form.date_of_birth(class="form-input") }}
        {% if form.date_of_birth.errors %}
          <div class="form-errors">
            {% for error in form.date_of_birth.errors %}<span class="error">{{ error }}</span>{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
  
  <div class="form-section">
    <h2>Contact Information</h2>
    <div class="form-row">
      <div class="form-group">
        {{ form.contact_phone.label(class="form-label") }}
        {{ form.contact_phone(class="form-input", placeholder="e.g., 07700 900123") }}
        {% if form.contact_phone.errors %}
          <div class="form-errors">
            {% for error in form.contact_phone.errors %}<span class="error">{{ error }}</span>{% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="form-group">
        {{ form.contact_email.label(class="form-label") }}
        {{ form.contact_email(class="form-input", placeholder="patient@example.com") }}
        {% if form.contact_email.errors %}
          <div class="form-errors">
            {% for error in form.contact_email.errors %}<span class="error">{{ error }}</span>{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
  
  <div class="form-section">
    <h2>Medical Status</h2>
    <div class="form-row">
      <div class="form-group">
        {{ form.status.label(class="form-label") }}
        {{ form.status(class="form-select") }}
        <small class="form-help">Patient's current medical status</small>
        {% if form.status.errors %}
          <div class="form-errors">
            {% for error in form.status.errors %}<span class="error">{{ error }}</span>{% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="form-group">
        {{ form.priority.label(class="form-label") }}
        {{ form.priority(class="form-select") }}
        <small class="form-help">Priority level for care and scheduling</small>
        {% if form.priority.errors %}
          <div class="form-errors">
            {% for error in form.priority.errors %}<span class="error">{{ error }}</span>{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
    
    <div class="form-group">
      {{ form.medical_notes.label(class="form-label") }}
      {{ form.medical_notes(class="form-textarea", rows=4, placeholder="Enter any relevant medical notes or observations...") }}
      <small class="form-help">Optional medical notes about the patient</small>
      {% if form.medical_notes.errors %}
        <div class="form-errors">
          {% for error in form.medical_notes.errors %}<span class="error">{{ error }}</span>{% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
  
  <div class="form-actions">
    {{ form.submit(class="button primary") }}
    <a href="{{ url_for('patients.list') }}" class="button secondary">Cancel</a>
    {% if patient %}
    <a href="{{ url_for('patients.detail', id=patient.id) }}" class="button secondary">View Patient</a>
    {% endif %}
  </div>
</form>
{% endblock %}
