{% extends "base.html" %}
{% block content %}
<h1>NHS Service Tracker Dashboard</h1>
<p>Welcome back, {{ current_user.full_name }}. Here's your system overview.</p>

<!-- Key Statistics -->
<div class="stats-grid">
  <div class="stat-card patients">
    <h3>{{ total_patients }}</h3>
    <p>Total Patients</p>
    <small>{{ active_patients }} active</small>
  </div>
  <div class="stat-card appointments">
    <h3>{{ today_appointments }}</h3>
    <p>Today's Appointments</p>
    <small>{{ this_week_appointments }} this week</small>
  </div>
  <div class="stat-card priority">
    <h3>{{ urgent_patients + high_priority_patients }}</h3>
    <p>Priority Patients</p>
    <small>{{ urgent_patients }} urgent, {{ high_priority_patients }} high</small>
  </div>
  <div class="stat-card services">
    <h3>{{ total_services }}</h3>
    <p>NHS Services</p>
    <small>Available for booking</small>
  </div>
</div>

<!-- Patient Status Overview -->
<div class="dashboard-section">
  <h2>Patient Status Distribution</h2>
  <div class="status-overview">
    {% for status, count in status_stats.items() %}
    <div class="status-item status-{{ status }}">
      <span class="status-count">{{ count }}</span>
      <span class="status-label">{{ status.title() }}</span>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Quick Actions -->
<div class="dashboard-section">
  <h2>Quick Actions</h2>
  <div class="grid">
    <a class="card action-card" href="{{ url_for('patients.create') }}">
      <h3>Add New Patient</h3>
      <p>Register a new patient in the system</p>
    </a>
    <a class="card action-card" href="{{ url_for('appointments.create') }}">
      <h3>Schedule Appointment</h3>
      <p>Book a new appointment for existing patients</p>
    </a>
    <a class="card action-card" href="{{ url_for('patients.list') }}">
      <h3>Search Patients</h3>
      <p>Find and manage patient records</p>
    </a>
    <a class="card action-card" href="{{ url_for('services.list') }}">
      <h3>Manage Services</h3>
      <p>View and configure NHS services</p>
    </a>
  </div>
</div>

<!-- Recent Activity & Urgent Items -->
<div class="dashboard-row">
  <div class="dashboard-column">
    <h2>Recent Patients</h2>
    {% if recent_patients %}
    <div class="recent-list">
      {% for patient in recent_patients %}
      <div class="recent-item">
        <a href="{{ url_for('patients.detail', id=patient.id) }}">
          <strong>{{ patient.first_name }} {{ patient.last_name }}</strong>
        </a>
        <span class="patient-info">
          NHS: {{ patient.nhs_number }} | 
          <span class="status-badge status-{{ patient.status }}">{{ patient.status.title() }}</span>
          {% if patient.priority != 'normal' %}
          <span class="priority-badge priority-{{ patient.priority }}">{{ patient.priority.title() }}</span>
          {% endif %}
        </span>
        <small>Added {{ patient.created_at.strftime('%d %b %Y') }}</small>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p>No recent patients to display.</p>
    {% endif %}
  </div>

  <div class="dashboard-column">
    <h2>Upcoming Appointments</h2>
    {% if urgent_appointments %}
    <div class="urgent-list">
      {% for appointment in urgent_appointments %}
      <div class="urgent-item">
        <div class="appointment-time">
          <strong>{{ appointment.scheduled_for.strftime('%d %b') }}</strong>
          <small>{{ appointment.scheduled_for.strftime('%H:%M') }}</small>
        </div>
        <div class="appointment-details">
          <a href="{{ url_for('patients.detail', id=appointment.patient.id) }}">
            {{ appointment.patient.first_name }} {{ appointment.patient.last_name }}
          </a>
          <small>{{ appointment.service.name }} - {{ appointment.location }}</small>
          {% if appointment.patient.priority in ['high', 'urgent'] %}
          <span class="priority-badge priority-{{ appointment.patient.priority }}">
            {{ appointment.patient.priority.title() }}
          </span>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p>No urgent appointments in the next 24 hours.</p>
    {% endif %}
  </div>
</div>

<!-- Main Navigation Cards -->
<div class="dashboard-section">
  <h2>System Overview</h2>
  <div class="grid">
    <a class="card overview-card" href="{{ url_for('patients.list') }}">
      <h3>Patients ({{ total_patients }})</h3>
      <p>Manage patient records and demographics</p>
      <div class="card-stats">
        <span>{{ active_patients }} Active</span>
        <span>{{ status_stats.get('discharged', 0) }} Discharged</span>
      </div>
    </a>
    <a class="card overview-card" href="{{ url_for('services.list') }}">
      <h3>Services ({{ total_services }})</h3>
      <p>NHS clinical services and specialties</p>
      <div class="card-stats">
        <span>Available for booking</span>
      </div>
    </a>
    <a class="card overview-card" href="{{ url_for('appointments.list') }}">
      <h3>Appointments ({{ total_appointments }})</h3>
      <p>Schedule and track patient appointments</p>
      <div class="card-stats">
        <span>{{ today_appointments }} Today</span>
        <span>{{ this_week_appointments }} This Week</span>
      </div>
    </a>
  </div>
</div>
{% endblock %}
